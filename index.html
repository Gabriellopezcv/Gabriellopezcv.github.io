<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas del Conflicto en Palestina (Oct 2023 - Presente)</title>
    
    <!-- Bootstrap CSS (para el diseño) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Estilos personalizados -->
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }
        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
        }
        .card-title {
            color: #bb86fc;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #f8f9fa;
        }
        .table {
            --bs-table-bg: #1e1e1e;
            --bs-table-striped-bg: #2c2c2c;
            --bs-table-color: #e0e0e0;
            --bs-table-border-color: #333;
        }
        h1, h2 {
            color: #bb86fc;
            border-bottom: 2px solid #3700b3;
            padding-bottom: 10px;
        }
        .loading-spinner {
            width: 3rem;
            height: 3rem;
        }
        .source-link {
            color: #03dac6;
            text-decoration: none;
        }
        .source-link:hover {
            color: #ffffff;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <header class="text-center mb-5">
            <h1>Estadísticas del Conflicto en Palestina</h1>
            <p class="lead">Datos actualizados desde el 7 de Octubre de 2023. La información se obtiene automáticamente del repositorio <a href="https://github.com/TechForPalestine/palestine-datasets" target="_blank" class="source-link">TechForPalestine/palestine-datasets</a>.</p>
        </header>

        <!-- Sección de Resumen -->
        <section id="summary-section" class="mb-5">
            <h2 class="mb-4">Resumen Total</h2>
            <div id="loader" class="d-flex justify-content-center">
                <div class="spinner-border text-primary loading-spinner" role="status">
                    <span class="visually-hidden">Cargando datos...</span>
                </div>
            </div>
            <div id="summary-cards" class="row d-none">
                <!-- Tarjetas de estadísticas -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Total de Víctimas (Gaza + Cisjordania)</h5>
                            <p id="total-martyrs" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Víctimas en Gaza</h5>
                            <p id="gaza-martyrs" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Víctimas en Cisjordania</h5>
                            <p id="wb-martyrs" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Total de Heridos (Gaza)</h5>
                            <p id="total-injured" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                 <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Niños/as Asesinados (Gaza)</h5>
                            <p id="children-martyrs" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Mujeres Asesinadas (Gaza)</h5>
                            <p id="women-martyrs" class="stat-number">0</p>
                        </div>
                    </div>
                </div>
                 <div class="col-md-6 col-lg-6 mb-4">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Última actualización de datos</h5>
                            <p id="last-update" class="stat-number" style="font-size: 1.8rem;">--</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Gráficos -->
        <section id="charts-section" class="mb-5 d-none">
            <h2 class="mb-4">Visualización de Datos</h2>
            <div class="row">
                <div class="col-lg-12 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <canvas id="dailyDeathsChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <canvas id="cumulativeDeathsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Tabla de Datos -->
        <section id="table-section" class="mb-5 d-none">
            <h2 class="mb-4">Datos Diarios Detallados (Gaza)</h2>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Nuevas Víctimas</th>
                            <th>Total Acumulado</th>
                            <th>Nuevos Heridos</th>
                            <th>Total Heridos</th>
                            <th>Nuevos Niños Víctimas</th>
                            <th>Total Niños Víctimas</th>
                            <th>Nuevas Mujeres Víctimas</th>
                            <th>Total Mujeres Víctimas</th>
                        </tr>
                    </thead>
                    <tbody id="gaza-table-body">
                        <!-- Filas de la tabla se insertarán aquí con JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <footer class="text-center mt-5">
            <p><small>Página creada con fines informativos. Los datos son propiedad de sus respectivos autores en el repositorio de GitHub.</small></p>
        </footer>
    </div>

    <!-- Librerías de JavaScript -->
    <!-- Papa Parse (para leer archivos CSV) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Chart.js (para los gráficos) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // URLs de los datos en formato RAW desde GitHub
            const gazaDailyURL = 'https://raw.githubusercontent.com/TechForPalestine/palestine-datasets/main/data/gaza_daily_martyrs_2023_2024.csv';
            const westBankDailyURL = 'https://raw.githubusercontent.com/TechForPalestine/palestine-datasets/main/data/west_bank_daily_martyrs_2023_2024.csv';
            
            // Función para obtener y procesar los datos
            async function fetchData() {
                try {
                    const [gazaResponse, wbResponse] = await Promise.all([
                        fetch(gazaDailyURL),
                        fetch(westBankDailyURL)
                    ]);

                    const gazaText = await gazaResponse.text();
                    const wbText = await wbResponse.text();
                    
                    // Parsear los datos CSV
                    const gazaData = Papa.parse(gazaText, { header: true, dynamicTyping: true, skipEmptyLines: true }).data;
                    const wbData = Papa.parse(wbText, { header: true, dynamicTyping: true, skipEmptyLines: true }).data;
                    
                    // Filtrar filas vacías o con fechas inválidas
                    const cleanGazaData = gazaData.filter(row => row.date && row.cumulative_martyrs != null);
                    const cleanWbData = wbData.filter(row => row.date && row.cumulative_martyrs != null);

                    updateSummaryCards(cleanGazaData, cleanWbData);
                    createCharts(cleanGazaData, cleanWbData);
                    populateTable(cleanGazaData);
                    
                    // Ocultar el spinner y mostrar el contenido
                    document.getElementById('loader').classList.add('d-none');
                    document.getElementById('summary-cards').classList.remove('d-none');
                    document.getElementById('charts-section').classList.remove('d-none');
                    document.getElementById('table-section').classList.remove('d-none');

                } catch (error) {
                    console.error("Error al obtener los datos:", error);
                    document.getElementById('loader').innerHTML = `<p class="text-danger">Error al cargar los datos. Por favor, intenta de nuevo más tarde.</p>`;
                }
            }

            function formatNumber(num) {
                if (num === null || num === undefined) return 'N/A';
                return num.toLocaleString('es-ES');
            }

            function updateSummaryCards(gazaData, wbData) {
                const latestGaza = gazaData[gazaData.length - 1];
                const latestWb = wbData[wbData.length - 1];
                
                const gazaMartyrs = latestGaza.cumulative_martyrs || 0;
                const wbMartyrs = latestWb.cumulative_martyrs || 0;
                
                document.getElementById('total-martyrs').textContent = formatNumber(gazaMartyrs + wbMartyrs);
                document.getElementById('gaza-martyrs').textContent = formatNumber(gazaMartyrs);
                document.getElementById('wb-martyrs').textContent = formatNumber(wbMartyrs);
                document.getElementById('total-injured').textContent = formatNumber(latestGaza.cumulative_injured);
                document.getElementById('children-martyrs').textContent = formatNumber(latestGaza.cumulative_children_martyrs);
                document.getElementById('women-martyrs').textContent = formatNumber(latestGaza.cumulative_women_martyrs);
                document.getElementById('last-update').textContent = latestGaza.date;
            }
            
            function createCharts(gazaData, wbData) {
                // Preparar datos para los gráficos
                const labels = gazaData.map(row => row.date);
                const gazaDaily = gazaData.map(row => row.daily_martyrs);
                const gazaCumulative = gazaData.map(row => row.cumulative_martyrs);
                
                // Mapear datos de Cisjordania a las mismas fechas que Gaza
                const wbDataMap = new Map(wbData.map(row => [row.date, row]));
                const wbDaily = labels.map(date => wbDataMap.get(date)?.daily_martyrs || 0);
                const wbCumulative = labels.map(date => wbDataMap.get(date)?.cumulative_martyrs || 0);

                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        },
                        title: {
                            display: true,
                            color: '#e0e0e0',
                            font: {
                                size: 18
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#e0e0e0' },
                            grid: { color: '#444' }
                        },
                        y: {
                            ticks: { color: '#e0e0e0' },
                            grid: { color: '#444' }
                        }
                    }
                };

                // Gráfico 1: Víctimas Diarias
                const dailyCtx = document.getElementById('dailyDeathsChart').getContext('2d');
                new Chart(dailyCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Víctimas Diarias en Gaza',
                                data: gazaDaily,
                                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Víctimas Diarias en Cisjordania',
                                data: wbDaily,
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { ...chartOptions.plugins.title, text: 'Víctimas Diarias' }}, scales: { ...chartOptions.scales, x: { ...chartOptions.scales.x, stacked: true }, y: { ...chartOptions.scales.y, stacked: true } } }
                });

                // Gráfico 2: Víctimas Acumuladas
                const cumulativeCtx = document.getElementById('cumulativeDeathsChart').getContext('2d');
                new Chart(cumulativeCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Total Víctimas en Gaza',
                                data: gazaCumulative,
                                borderColor: '#e91e63',
                                backgroundColor: '#e91e6320',
                                fill: true,
                                tension: 0.1
                            },
                             {
                                label: 'Total Víctimas en Cisjordania',
                                data: wbCumulative,
                                borderColor: '#2196f3',
                                backgroundColor: '#2196f320',
                                fill: true,
                                tension: 0.1
                            }
                        ]
                    },
                    options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { ...chartOptions.plugins.title, text: 'Evolución de Víctimas Acumuladas' }}}
                });
            }
            
            function populateTable(gazaData) {
                const tableBody = document.getElementById('gaza-table-body');
                tableBody.innerHTML = ''; // Limpiar tabla
                
                // Mostrar los datos más recientes primero
                const reversedData = [...gazaData].reverse();
                
                reversedData.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.date || 'N/A'}</td>
                        <td>${formatNumber(row.daily_martyrs)}</td>
                        <td>${formatNumber(row.cumulative_martyrs)}</td>
                        <td>${formatNumber(row.daily_injured)}</td>
                        <td>${formatNumber(row.cumulative_injured)}</td>
                        <td>${formatNumber(row.daily_children_martyrs)}</td>
                        <td>${formatNumber(row.cumulative_children_martyrs)}</td>
                        <td>${formatNumber(row.daily_women_martyrs)}</td>
                        <td>${formatNumber(row.cumulative_women_martyrs)}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            // Iniciar la carga de datos
            fetchData();
        });
    </script>
</body>
</html>